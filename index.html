<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<title>Photo-show</title>
	<script src="js/zepto.min.js"></script>
	<link rel="stylesheet" href="css/animate.css">
	<style type="text/css">
		html,body,ul{
			margin: 0;
			padding: 0;
		}
		body{
			background: #080115;
		}	
		ul{
			list-style: none;
		}
		li{
			overflow: hidden;
			float: left;
		}
		.show-image{
			position: absolute;
			width: 100%;
			height: 100%;
			background: #080115;
			display: none;
		}
	</style>
</head>
<body>

	<ul id="container">
	</ul>

	<div id="large-image" class="show-image">
		<img class="showImg" alt=""/>
	</div>
	

	<script src='js/touch.js'></script>
	<script>

		var imgs = 17;
		var padding = 2;
		var column = 4;
		var win = $(window);
		var container = $('#container');
		var showImg = $('.showImg');
		var largeImg = $('#large-image');

		var render = function(){
			var winWidth = win.width();
			var liWidth = Math.floor( (winWidth - padding*3)/column );
			var model = '';
			
			for( var i = 1; i <= imgs; i++ ){
				var p = i%column === 1? 0 : padding;
				var imgSrc = 'images/'+ i +'.jpg';
				model += '<li data-id="'+i+'" class="animated zoomIn" style="width:'+liWidth+'px; height:'+liWidth+'px; padding-left:'+ p +'px;padding-top:'+ padding +'px;"><canvas id="cvs_'+ i +'"></canvas></li>';
				
				var imageObj = new Image();
				imageObj.index = i;

				imageObj.onload = function(){
					var cvs = $('#cvs_'+this.index)[0].getContext('2d');
					cvs.width = this.width;
					cvs.height = this.height;
					cvs.drawImage(this, 0, 0);
				};
				imageObj.src = imgSrc;
			}

			container.html(model);

		};

		render();

		var loadImg = function(id){
			
			largeImg.css({
				width: win.width(),
				height: win.height()
			}).show();

			var imgSrc = 'images/'+ id +'.large.jpg';
			var imageObj = new Image();
			imageObj.onload = function(){
				var w = this.width;
				var h = this.height;
				var winW = win.width();
				var winH = win.height();
				/**计算图片显示时的高度和宽度
				**这里需要注意理解这个reaW和realH究竟是什么值
				**当图片是高大于宽，那么图片显示的高度取值跟屏幕一样
				**图片显示的宽度取值就可以这样计算：w/h = realWidth/realHight（注意图片是等比例缩放关系）
				**所以reaW = realH*w/h,realH = winH; 
				**/
				var realW = winH*w/h;
				var realH = winW*h/w;
				/**计算在展示大图时根据图片的比例来确定左右上下padding值
				**当图片是一个高度大于宽度的图片是使用paddingLeft
				**当图片是一个宽度大于高度的图片是使用paddingTop
				**/ 
				var paddingLeft = parseInt( (winW-realW)/2 );
				var paddingTop = parseInt( (winH-realH)/2 );
				// 设置css样式
				var css = [
					{
						'height': winH,
						'padding-left': paddingLeft
					},{
						'width': winW,
						'padding-top': paddingTop
					}
				];

				showImg.attr('src',imgSrc).css( h/w>1.2 ? css[0] : css[1]);


			};

			imageObj.src = imgSrc;
		};

		// 绑定事件代理，加快响应
		container.delegate('li', 'tap', function(){
			var _id = $(this).attr('data-id');
			loadImg(_id);
		});

	</script>
</body>
</html>